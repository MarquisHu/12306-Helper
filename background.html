<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<script type="text/javascript">
function defval(val1, defvalue)
{
	return (val1 && val1 != undefined) ? val1 : defvalue;
}

function loadStations() {
	var stations = {from: {code: defval(localStorage.fromStationCode, "HBB"), name: defval(localStorage.fromStationName, "哈尔滨")},
		    to: {code: defval(localStorage.toStationCode, "BJP"), name: defval(localStorage.toStationName, "北京")}
	};
	return stations;
}

function loadLogins() {
	var logins = {username: defval(localStorage.username, ""), password: defval(localStorage.password, "")};
	return logins;
}

function saveStations(stations) {
	console.log ("prepare to save stations " + stations.from.code + " --> " + stations.to.code);
	localStorage.fromStationCode = stations.from.code;
	localStorage.fromStationName = stations.from.name;
	localStorage.toStationCode = stations.to.code;
	localStorage.toStationName = stations.to.name;
	return true;
}

function saveLogins(logins) {
	localStorage.username = logins.username;
	localStorage.password = logins.password;
	return true;
}

chrome.extension.onRequest.addListener( function(request, sender, sendResponse) 
{
	var reqItem = request.what;
	console.log ("recv request: " + reqItem);
	if (reqItem == "stations") {
		var stations = loadStations();
		sendResponse(stations);
	} else if(reqItem == "logins") {
		sendResponse(loadLogins()); // snub them.
	} else if (reqItem == "saveStations") {
		var ret = saveStations(request.stations);
		sendResponse({ok: ret});
	} else if (reqItem == "saveLogins") {
		var ret = saveLogins (request.logins);
		sendResponse({ok: ret});
	} else if (reqItem == "ticketNotify") {
		if (Audio) {
			new Audio("hasticket.ogg").play();
		}
		sendResponse({ok:true});
	}
});
</script>
</head>

<body>
</body>

</html>
